
CREATE TABLE [dbo].[KHACHHANG](
	[MAKH] [int] IDENTITY(1,1) NOT NULL,
	[TENKH] [nvarchar](50) NULL,
	[SDTKH] [char](11) NULL,
	[DIACHI] [nvarchar](50) NULL,
	[TONGTIEN] [int] NULL,
PRIMARY KEY CLUSTERED 
(
	[MAKH] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[HOADON]    Script Date: 12/2/2021 4:06:48 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[HOADON](
	[MAHD] [int] IDENTITY(1,1) NOT NULL,
	[MAKH] [int] NOT NULL,
	[NVBAN] [nvarchar](200) NULL,
	[TGMUA] [date] NOT NULL,
	[TONGTIEN] [int] NULL,
	[STATUS] [int] NULL,
PRIMARY KEY CLUSTERED 
(
	[MAHD] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  View [dbo].[BILLVIEW]    Script Date: 12/2/2021 4:06:48 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
---ViewBill
CREATE VIEW [dbo].[BILLVIEW]
AS
SELECT MAHD, KH.TENKH, KH.SDTKH, TGMUA, HD.TONGTIEN
FROM HOADON HD 
INNER JOIN KHACHHANG KH ON KH.MAKH = HD.MAKH 
GO
/****** Object:  Table [dbo].[SANPHAM]    Script Date: 12/2/2021 4:06:48 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[SANPHAM](
	[MASP] [int] IDENTITY(1,1) NOT NULL,
	[TENSP] [nvarchar](100) NULL,
	[LOAISP] [int] NOT NULL,
	[SOLUONGTON] [int] NULL,
	[DONGIA] [int] NULL,
PRIMARY KEY CLUSTERED 
(
	[MASP] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[CHITIETHOADON]    Script Date: 12/2/2021 4:06:48 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[CHITIETHOADON](
	[ID] [int] IDENTITY(1,1) NOT NULL,
	[MAHD] [int] NULL,
	[MASP] [int] NULL,
	[SL] [int] NULL,
PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  View [dbo].[VIEWBILLINFO]    Script Date: 12/2/2021 4:06:48 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


CREATE VIEW [dbo].[VIEWBILLINFO]
AS
SELECT  TENSP, SL, DONGIA, DONGIA*SL AS'TONGGIA' FROM CHITIETHOADON CT INNER JOIN SANPHAM ON SANPHAM.MASP = CT.MASP INNER JOIN HOADON ON HOADON.MAHD = CT.MAHD INNER JOIN KHACHHANG ON HOADON.MAKH = KHACHHANG.MAKH WHERE KHACHHANG.MAKH = 2
GO
/****** Object:  Table [dbo].[ACCOUNT]    Script Date: 12/2/2021 4:06:48 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[ACCOUNT](
	[ID] [int] IDENTITY(1,1) NOT NULL,
	[USERNAME] [char](50) NOT NULL,
	[PASSWORD] [char](200) NULL,
	[TYPE] [int] NOT NULL,
PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[LOAISP]    Script Date: 12/2/2021 4:06:48 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[LOAISP](
	[MALOAI] [int] IDENTITY(1,1) NOT NULL,
	[TENLOAI] [nvarchar](50) NULL,
PRIMARY KEY CLUSTERED 
(
	[MALOAI] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]
GO
SET IDENTITY_INSERT [dbo].[ACCOUNT] ON 

INSERT [dbo].[ACCOUNT] ([ID], [USERNAME], [PASSWORD], [TYPE]) VALUES (1, N'admin                                             ', N'123456                                                                                                                                                                                                  ', 0)
INSERT [dbo].[ACCOUNT] ([ID], [USERNAME], [PASSWORD], [TYPE]) VALUES (2, N'teo                                               ', N'123456                                                                                                                                                                                                  ', 0)
INSERT [dbo].[ACCOUNT] ([ID], [USERNAME], [PASSWORD], [TYPE]) VALUES (3, N'staff                                             ', N'123                                                                                                                                                                                                     ', 1)
SET IDENTITY_INSERT [dbo].[ACCOUNT] OFF
GO
SET IDENTITY_INSERT [dbo].[CHITIETHOADON] ON 

INSERT [dbo].[CHITIETHOADON] ([ID], [MAHD], [MASP], [SL]) VALUES (1, 1, 6, 4)
INSERT [dbo].[CHITIETHOADON] ([ID], [MAHD], [MASP], [SL]) VALUES (2, 2, 9, 2)
INSERT [dbo].[CHITIETHOADON] ([ID], [MAHD], [MASP], [SL]) VALUES (3, 2, 27, 1)
INSERT [dbo].[CHITIETHOADON] ([ID], [MAHD], [MASP], [SL]) VALUES (4, 2, 29, 1)
INSERT [dbo].[CHITIETHOADON] ([ID], [MAHD], [MASP], [SL]) VALUES (5, 3, 11, 4)
INSERT [dbo].[CHITIETHOADON] ([ID], [MAHD], [MASP], [SL]) VALUES (6, 3, 16, 1)
INSERT [dbo].[CHITIETHOADON] ([ID], [MAHD], [MASP], [SL]) VALUES (7, 4, 13, 2)
INSERT [dbo].[CHITIETHOADON] ([ID], [MAHD], [MASP], [SL]) VALUES (8, 5, 34, 3)
INSERT [dbo].[CHITIETHOADON] ([ID], [MAHD], [MASP], [SL]) VALUES (9, 6, 33, 2)
INSERT [dbo].[CHITIETHOADON] ([ID], [MAHD], [MASP], [SL]) VALUES (10, 7, 19, 1)
INSERT [dbo].[CHITIETHOADON] ([ID], [MAHD], [MASP], [SL]) VALUES (11, 8, 20, 1)
INSERT [dbo].[CHITIETHOADON] ([ID], [MAHD], [MASP], [SL]) VALUES (12, 8, 17, 1)
INSERT [dbo].[CHITIETHOADON] ([ID], [MAHD], [MASP], [SL]) VALUES (13, 9, 25, 1)
INSERT [dbo].[CHITIETHOADON] ([ID], [MAHD], [MASP], [SL]) VALUES (14, 10, 25, 2)
INSERT [dbo].[CHITIETHOADON] ([ID], [MAHD], [MASP], [SL]) VALUES (15, 11, 25, 2)
INSERT [dbo].[CHITIETHOADON] ([ID], [MAHD], [MASP], [SL]) VALUES (16, 12, 25, 2)
INSERT [dbo].[CHITIETHOADON] ([ID], [MAHD], [MASP], [SL]) VALUES (17, 13, 25, 3)
INSERT [dbo].[CHITIETHOADON] ([ID], [MAHD], [MASP], [SL]) VALUES (29, 14, 1, 2)
INSERT [dbo].[CHITIETHOADON] ([ID], [MAHD], [MASP], [SL]) VALUES (30, 15, 1, 1)
INSERT [dbo].[CHITIETHOADON] ([ID], [MAHD], [MASP], [SL]) VALUES (31, 16, 1, 1)
INSERT [dbo].[CHITIETHOADON] ([ID], [MAHD], [MASP], [SL]) VALUES (32, 16, 8, 2)
INSERT [dbo].[CHITIETHOADON] ([ID], [MAHD], [MASP], [SL]) VALUES (33, 17, 1, 1)
INSERT [dbo].[CHITIETHOADON] ([ID], [MAHD], [MASP], [SL]) VALUES (34, 18, 1, 2)
SET IDENTITY_INSERT [dbo].[CHITIETHOADON] OFF
GO
SET IDENTITY_INSERT [dbo].[HOADON] ON 

INSERT [dbo].[HOADON] ([MAHD], [MAKH], [NVBAN], [TGMUA], [TONGTIEN], [STATUS]) VALUES (1, 1, N'admin                                             ', CAST(N'2020-12-05' AS Date), 199999, 1)
INSERT [dbo].[HOADON] ([MAHD], [MAKH], [NVBAN], [TGMUA], [TONGTIEN], [STATUS]) VALUES (2, 2, N'admin                                             ', CAST(N'2020-12-05' AS Date), 712000, 1)
INSERT [dbo].[HOADON] ([MAHD], [MAKH], [NVBAN], [TGMUA], [TONGTIEN], [STATUS]) VALUES (3, 3, N'admin                                             ', CAST(N'2020-12-05' AS Date), 3200000, 1)
INSERT [dbo].[HOADON] ([MAHD], [MAKH], [NVBAN], [TGMUA], [TONGTIEN], [STATUS]) VALUES (4, 3, N'admin                                             ', CAST(N'2020-12-05' AS Date), 3200000, 1)
INSERT [dbo].[HOADON] ([MAHD], [MAKH], [NVBAN], [TGMUA], [TONGTIEN], [STATUS]) VALUES (5, 4, N'admin                                             ', CAST(N'2020-12-05' AS Date), 1147180, 1)
INSERT [dbo].[HOADON] ([MAHD], [MAKH], [NVBAN], [TGMUA], [TONGTIEN], [STATUS]) VALUES (6, 4, N'admin                                             ', CAST(N'2020-12-05' AS Date), 1147180, 1)
INSERT [dbo].[HOADON] ([MAHD], [MAKH], [NVBAN], [TGMUA], [TONGTIEN], [STATUS]) VALUES (7, 9, N'admin                                             ', CAST(N'2020-12-05' AS Date), 199000, 1)
INSERT [dbo].[HOADON] ([MAHD], [MAKH], [NVBAN], [TGMUA], [TONGTIEN], [STATUS]) VALUES (8, 5, N'admin                                             ', CAST(N'2020-12-05' AS Date), 2298000, 1)
INSERT [dbo].[HOADON] ([MAHD], [MAKH], [NVBAN], [TGMUA], [TONGTIEN], [STATUS]) VALUES (9, 6, N'admin                                             ', CAST(N'2020-12-05' AS Date), 1390000, 1)
INSERT [dbo].[HOADON] ([MAHD], [MAKH], [NVBAN], [TGMUA], [TONGTIEN], [STATUS]) VALUES (10, 7, N'admin                                             ', CAST(N'2020-12-05' AS Date), 399998, 1)
INSERT [dbo].[HOADON] ([MAHD], [MAKH], [NVBAN], [TGMUA], [TONGTIEN], [STATUS]) VALUES (11, 8, N'admin                                             ', CAST(N'2020-12-05' AS Date), 2780000, 1)
INSERT [dbo].[HOADON] ([MAHD], [MAKH], [NVBAN], [TGMUA], [TONGTIEN], [STATUS]) VALUES (12, 8, N'admin                                             ', CAST(N'2020-12-05' AS Date), 2780000, 1)
INSERT [dbo].[HOADON] ([MAHD], [MAKH], [NVBAN], [TGMUA], [TONGTIEN], [STATUS]) VALUES (13, 1, N'admin                                             ', CAST(N'2020-12-05' AS Date), 199999, 1)
INSERT [dbo].[HOADON] ([MAHD], [MAKH], [NVBAN], [TGMUA], [TONGTIEN], [STATUS]) VALUES (14, 1, N'admin                                             ', CAST(N'2020-12-05' AS Date), 199999, 1)
INSERT [dbo].[HOADON] ([MAHD], [MAKH], [NVBAN], [TGMUA], [TONGTIEN], [STATUS]) VALUES (15, 1, N'admin                                             ', CAST(N'2021-11-28' AS Date), 199999, 1)
INSERT [dbo].[HOADON] ([MAHD], [MAKH], [NVBAN], [TGMUA], [TONGTIEN], [STATUS]) VALUES (16, 1, N'admin                                             ', CAST(N'2021-11-30' AS Date), 199999, 1)
INSERT [dbo].[HOADON] ([MAHD], [MAKH], [NVBAN], [TGMUA], [TONGTIEN], [STATUS]) VALUES (17, 1, N'admin                                             ', CAST(N'2021-11-30' AS Date), 199999, 1)
INSERT [dbo].[HOADON] ([MAHD], [MAKH], [NVBAN], [TGMUA], [TONGTIEN], [STATUS]) VALUES (18, 7, N'admin                                             ', CAST(N'2021-11-30' AS Date), 399998, 1)
SET IDENTITY_INSERT [dbo].[HOADON] OFF
GO
SET IDENTITY_INSERT [dbo].[KHACHHANG] ON 

INSERT [dbo].[KHACHHANG] ([MAKH], [TENKH], [SDTKH], [DIACHI], [TONGTIEN]) VALUES (1, N'Đăng', N'0326889240 ', N'Quận 7', 7549995)
INSERT [dbo].[KHACHHANG] ([MAKH], [TENKH], [SDTKH], [DIACHI], [TONGTIEN]) VALUES (2, N'Trung', N'123456     ', N'Quận8', 712000)
INSERT [dbo].[KHACHHANG] ([MAKH], [TENKH], [SDTKH], [DIACHI], [TONGTIEN]) VALUES (3, N'Thùy', N'987654     ', N'Quận 9', 12800000)
INSERT [dbo].[KHACHHANG] ([MAKH], [TENKH], [SDTKH], [DIACHI], [TONGTIEN]) VALUES (4, N'Huy', N'0258741    ', N'Quận6', 3541075)
INSERT [dbo].[KHACHHANG] ([MAKH], [TENKH], [SDTKH], [DIACHI], [TONGTIEN]) VALUES (5, N'Hạnh', N'0259678949 ', N'Bình Dương', 2298000)
INSERT [dbo].[KHACHHANG] ([MAKH], [TENKH], [SDTKH], [DIACHI], [TONGTIEN]) VALUES (6, N'Lâm', N'0171675475 ', N'Bình Phước', 1390000)
INSERT [dbo].[KHACHHANG] ([MAKH], [TENKH], [SDTKH], [DIACHI], [TONGTIEN]) VALUES (7, N'Huỳnh', N'0804351796 ', N'Đồng Nai', 3179998)
INSERT [dbo].[KHACHHANG] ([MAKH], [TENKH], [SDTKH], [DIACHI], [TONGTIEN]) VALUES (8, N'Bình', N'7053770318 ', N'Vũng Tàu', 5560000)
INSERT [dbo].[KHACHHANG] ([MAKH], [TENKH], [SDTKH], [DIACHI], [TONGTIEN]) VALUES (9, N'Nghĩa', N'9438485082 ', N'Lâm Đồng', 199000)
SET IDENTITY_INSERT [dbo].[KHACHHANG] OFF
GO
SET IDENTITY_INSERT [dbo].[LOAISP] ON 

INSERT [dbo].[LOAISP] ([MALOAI], [TENLOAI]) VALUES (1, N'DIỆT VIRUS')
INSERT [dbo].[LOAISP] ([MALOAI], [TENLOAI]) VALUES (2, N'WINDOWS')
INSERT [dbo].[LOAISP] ([MALOAI], [TENLOAI]) VALUES (3, N'VĂN PHÒNG')
INSERT [dbo].[LOAISP] ([MALOAI], [TENLOAI]) VALUES (4, N'GAME')
INSERT [dbo].[LOAISP] ([MALOAI], [TENLOAI]) VALUES (5, N'Đồ họa')
SET IDENTITY_INSERT [dbo].[LOAISP] OFF
GO
SET IDENTITY_INSERT [dbo].[SANPHAM] ON 

INSERT [dbo].[SANPHAM] ([MASP], [TENSP], [LOAISP], [SOLUONGTON], [DONGIA]) VALUES (1, N'Bitdefender Antivirus Plus', 1, 7, 199999)
INSERT [dbo].[SANPHAM] ([MASP], [TENSP], [LOAISP], [SOLUONGTON], [DONGIA]) VALUES (2, N'Kaspersky Anti-Virus', 1, 2, 299999)
INSERT [dbo].[SANPHAM] ([MASP], [TENSP], [LOAISP], [SOLUONGTON], [DONGIA]) VALUES (3, N'Webroot SecureAnywhere AntiVirus', 1, 3, 200000)
INSERT [dbo].[SANPHAM] ([MASP], [TENSP], [LOAISP], [SOLUONGTON], [DONGIA]) VALUES (4, N'McAfee AntiVirus Plus', 1, 4, 350000)
INSERT [dbo].[SANPHAM] ([MASP], [TENSP], [LOAISP], [SOLUONGTON], [DONGIA]) VALUES (5, N'ESET NOD32 Antivirus', 1, 5, 150000)
INSERT [dbo].[SANPHAM] ([MASP], [TENSP], [LOAISP], [SOLUONGTON], [DONGIA]) VALUES (6, N'Norton AntiVirus Plus', 1, 1, 490000)
INSERT [dbo].[SANPHAM] ([MASP], [TENSP], [LOAISP], [SOLUONGTON], [DONGIA]) VALUES (7, N'Emsisoft Anti-Malware', 1, 3, 205000)
INSERT [dbo].[SANPHAM] ([MASP], [TENSP], [LOAISP], [SOLUONGTON], [DONGIA]) VALUES (8, N'F-Secure Anti-Virus', 1, 6, 210000)
INSERT [dbo].[SANPHAM] ([MASP], [TENSP], [LOAISP], [SOLUONGTON], [DONGIA]) VALUES (9, N'Malwarebytes Premium', 1, 2, 170000)
INSERT [dbo].[SANPHAM] ([MASP], [TENSP], [LOAISP], [SOLUONGTON], [DONGIA]) VALUES (10, N'Sophos Home Premium', 1, 2, 150000)
INSERT [dbo].[SANPHAM] ([MASP], [TENSP], [LOAISP], [SOLUONGTON], [DONGIA]) VALUES (11, N'Windows 7 - 1 năm', 2, 2, 1500000)
INSERT [dbo].[SANPHAM] ([MASP], [TENSP], [LOAISP], [SOLUONGTON], [DONGIA]) VALUES (12, N'Windows 7 - 2 năm', 2, 7, 2900000)
INSERT [dbo].[SANPHAM] ([MASP], [TENSP], [LOAISP], [SOLUONGTON], [DONGIA]) VALUES (13, N'Windows 8 - 1 năm', 2, 4, 1600000)
INSERT [dbo].[SANPHAM] ([MASP], [TENSP], [LOAISP], [SOLUONGTON], [DONGIA]) VALUES (14, N'Windows 8 - 2 năm', 2, 3, 3100000)
INSERT [dbo].[SANPHAM] ([MASP], [TENSP], [LOAISP], [SOLUONGTON], [DONGIA]) VALUES (15, N'Windows 10 - 1 năm', 2, 10, 2000000)
INSERT [dbo].[SANPHAM] ([MASP], [TENSP], [LOAISP], [SOLUONGTON], [DONGIA]) VALUES (16, N'Windows 8 - 2 năm', 2, 3, 3600000)
INSERT [dbo].[SANPHAM] ([MASP], [TENSP], [LOAISP], [SOLUONGTON], [DONGIA]) VALUES (17, N'Microsoft Office 365 2 năm', 3, 6, 1699000)
INSERT [dbo].[SANPHAM] ([MASP], [TENSP], [LOAISP], [SOLUONGTON], [DONGIA]) VALUES (18, N'Microsoft Office 365 1 năm', 3, 4, 986000)
INSERT [dbo].[SANPHAM] ([MASP], [TENSP], [LOAISP], [SOLUONGTON], [DONGIA]) VALUES (19, N'Teamview 14 - 1 năm', 3, 7, 199000)
INSERT [dbo].[SANPHAM] ([MASP], [TENSP], [LOAISP], [SOLUONGTON], [DONGIA]) VALUES (20, N'WPS Office 1 năm', 3, 4, 599000)
INSERT [dbo].[SANPHAM] ([MASP], [TENSP], [LOAISP], [SOLUONGTON], [DONGIA]) VALUES (21, N'Dead Cell', 4, 5, 140000)
INSERT [dbo].[SANPHAM] ([MASP], [TENSP], [LOAISP], [SOLUONGTON], [DONGIA]) VALUES (22, N'Đĩa Game PS4 Final Fantasy XII: The Zodiac Age', 4, 5, 580000)
INSERT [dbo].[SANPHAM] ([MASP], [TENSP], [LOAISP], [SOLUONGTON], [DONGIA]) VALUES (23, N'Đĩa Game PS4 Pes 2021 Hệ EU', 4, 5, 680000)
INSERT [dbo].[SANPHAM] ([MASP], [TENSP], [LOAISP], [SOLUONGTON], [DONGIA]) VALUES (24, N'Đĩa Game PS4 Pes 2021 Hệ Asia', 4, 2, 780000)
INSERT [dbo].[SANPHAM] ([MASP], [TENSP], [LOAISP], [SOLUONGTON], [DONGIA]) VALUES (25, N'Đĩa Game PS4 Fifa 21 Hệ Asia', 4, 5, 1390000)
INSERT [dbo].[SANPHAM] ([MASP], [TENSP], [LOAISP], [SOLUONGTON], [DONGIA]) VALUES (26, N'8-Bit Armies', 4, 15, 82000)
INSERT [dbo].[SANPHAM] ([MASP], [TENSP], [LOAISP], [SOLUONGTON], [DONGIA]) VALUES (27, N'Rise of the Tomb Raider: 20 Year Celebration', 4, 28, 310000)
INSERT [dbo].[SANPHAM] ([MASP], [TENSP], [LOAISP], [SOLUONGTON], [DONGIA]) VALUES (28, N'Pummel Party', 4, 15, 108000)
INSERT [dbo].[SANPHAM] ([MASP], [TENSP], [LOAISP], [SOLUONGTON], [DONGIA]) VALUES (29, N'Warhammer: Vermintide 2', 4, 15, 62000)
INSERT [dbo].[SANPHAM] ([MASP], [TENSP], [LOAISP], [SOLUONGTON], [DONGIA]) VALUES (30, N'Killing Floor 2 Digital Deluxe Edition', 4, 18, 102000)
INSERT [dbo].[SANPHAM] ([MASP], [TENSP], [LOAISP], [SOLUONGTON], [DONGIA]) VALUES (31, N'Adobe Creative Cloud (PC) - 1 Year - Adobe Key GLOBAL', 5, 8, 3066845)
INSERT [dbo].[SANPHAM] ([MASP], [TENSP], [LOAISP], [SOLUONGTON], [DONGIA]) VALUES (32, N'3D Sprite Renderer Steam Gift GLOBAL', 5, 8, 942259)
INSERT [dbo].[SANPHAM] ([MASP], [TENSP], [LOAISP], [SOLUONGTON], [DONGIA]) VALUES (33, N'Shadron Steam Gift GLOBAL', 5, 13, 573590)
INSERT [dbo].[SANPHAM] ([MASP], [TENSP], [LOAISP], [SOLUONGTON], [DONGIA]) VALUES (34, N'PD Howler 9.6 Digital Painter and Visual FX box Steam Key GLOBAL', 5, 6, 797965)
SET IDENTITY_INSERT [dbo].[SANPHAM] OFF
GO
/****** Object:  Index [UQ__LOAISP__2F633F22D58880A8]    Script Date: 12/2/2021 4:06:48 PM ******/
ALTER TABLE [dbo].[LOAISP] ADD UNIQUE NONCLUSTERED 
(
	[MALOAI] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
GO
ALTER TABLE [dbo].[ACCOUNT] ADD  DEFAULT ((0)) FOR [TYPE]
GO
ALTER TABLE [dbo].[CHITIETHOADON] ADD  DEFAULT ((1)) FOR [SL]
GO
ALTER TABLE [dbo].[HOADON] ADD  DEFAULT (getdate()) FOR [TGMUA]
GO
ALTER TABLE [dbo].[HOADON] ADD  DEFAULT ((0)) FOR [STATUS]
GO
ALTER TABLE [dbo].[KHACHHANG] ADD  DEFAULT ((0)) FOR [TONGTIEN]
GO
ALTER TABLE [dbo].[CHITIETHOADON]  WITH CHECK ADD FOREIGN KEY([MAHD])
REFERENCES [dbo].[HOADON] ([MAHD])
GO
ALTER TABLE [dbo].[CHITIETHOADON]  WITH CHECK ADD FOREIGN KEY([MASP])
REFERENCES [dbo].[SANPHAM] ([MASP])
GO
ALTER TABLE [dbo].[HOADON]  WITH CHECK ADD FOREIGN KEY([MAKH])
REFERENCES [dbo].[KHACHHANG] ([MAKH])
GO
ALTER TABLE [dbo].[SANPHAM]  WITH CHECK ADD FOREIGN KEY([LOAISP])
REFERENCES [dbo].[LOAISP] ([MALOAI])
GO
/****** Object:  StoredProcedure [dbo].[PROC_GETBILLINFO]    Script Date: 12/2/2021 4:06:48 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
create PROC [dbo].[PROC_GETBILLINFO]
@idBill int
AS
BEGIN
	SELECT SP.TENSP, SP.DONGIA, CT.SL, CT.SL*SP.DONGIA AS'THANHTIENSP' FROM CHITIETHOADON CT INNER JOIN SANPHAM SP ON SP.MASP = CT.MASP WHERE CT.MAHD = @idBill
	
END
GO
/****** Object:  StoredProcedure [dbo].[PROC_GETDOANHTHUBYDATE]    Script Date: 12/2/2021 4:06:48 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE PROC [dbo].[PROC_GETDOANHTHUBYDATE]
@start date, @end date
AS
BEGIN
	SET DATEFORMAT DMY  
	SELECT HD.MAHD,KH.TENKH, NVBAN, HD.TONGTIEN, HD.TGMUA  FROM HOADON HD INNER JOIN KHACHHANG KH ON KH.MAKH = HD.MAKH WHERE HD.TGMUA>= @start AND HD.TGMUA<=@end
END
GO
/****** Object:  StoredProcedure [dbo].[PROC_GETSANPHAMBYDATE]    Script Date: 12/2/2021 4:06:48 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create proc [dbo].[PROC_GETSANPHAMBYDATE]
@start date, @end date
as
Begin
	SET DATEFORMAT dmy
	SELECT SANPHAM.MASP, SANPHAM.TENSP,SOLUONG, SANPHAM.DONGIA, SOLUONG*SANPHAM.DONGIA AS'TONGTIEN' FROM SANPHAM INNER JOIN (SELECT SP.MASP, SUM(CT.SL) as 'SOLUONG' FROM SANPHAM SP INNER JOIN CHITIETHOADON CT ON SP.MASP = CT.MASP INNER JOIN HOADON HD ON HD.MAHD = CT.MAHD WHERE HD.TGMUA >=@start AND HD.TGMUA <=@end GROUP BY  SP.MASP) AS X ON X.MASP = SANPHAM.MASP ORDER BY SOLUONG DESC
end
GO
/****** Object:  StoredProcedure [dbo].[PROC_THANHTOAN]    Script Date: 12/2/2021 4:06:48 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
--thanh toan

CREATE PROC [dbo].[PROC_THANHTOAN]
@IDKH INT
AS
BEGIN
	DECLARE @MONEY INT
	DECLARE @IDHD INT
	SELECT @MONEY=TONGTIEN FROM KHACHHANG WHERE @IDKH = MAKH
	SELECT  @IDHD=MAHD FROM HOADON HD INNER JOIN KHACHHANG KH ON KH.MAKH = HD.MAKH WHERE HD.STATUS = 0
	UPDATE KHACHHANG 
	SET TONGTIEN = (SELECT SUM(DONGIA*SL)
			FROM CHITIETHOADON CT
			INNER JOIN SANPHAM SP ON SP.MASP = CT.MASP
			WHERE CT.MAHD = @IDHD) + @MONEY
	WHERE MAKH = @IDKH

	UPDATE HOADON
	SET STATUS = 1, TONGTIEN  = (SELECT SUM(DONGIA*SL)
							FROM CHITIETHOADON CT
							INNER JOIN SANPHAM SP ON SP.MASP = CT.MASP
							WHERE CT.MAHD = @IDHD)
	WHERE MAKH = @IDKH
END


GO
/****** Object:  StoredProcedure [dbo].[USP_INSERTBILL]    Script Date: 12/2/2021 4:06:48 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


---- TẠO 1 BILL MỚI

CREATE PROC [dbo].[USP_INSERTBILL] 
@MAKH INT, @NVBAN CHAR(50)
AS
BEGIN
	INSERT DBO.HOADON([MAKH] ,[NVBAN] ,[TGMUA] ,[TONGTIEN])
	VALUES (@MAKH, @NVBAN,GETDATE(),0)
END
GO
/****** Object:  StoredProcedure [dbo].[USP_INSERTBILLINFO]    Script Date: 12/2/2021 4:06:48 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
--- tao don hang

create PROC [dbo].[USP_INSERTBILLINFO]
@idBill int, @idProduct int, @count int
AS
BEGIN
	DECLARE @ISEXISTBILLINFO INT;
	DECLARE @COUNTPRODUCT INT = 1;
	SELECT @ISEXISTBILLINFO = X.ID , @COUNTPRODUCT = X.SL  FROM DBO.CHITIETHOADON as X WHERE MAHD = @idBill AND MASP = @idProduct
	IF(@ISEXISTBILLINFO >0)
	BEGIN
		DECLARE @NEWCOUNT INT = @COUNTPRODUCT + @count 
		IF(@NEWCOUNT >0)
			UPDATE CHITIETHOADON SET SL = @NEWCOUNT WHERE MAHD = @idBill AND @idProduct =MASP
		ELSE
			DELETE CHITIETHOADON WHERE MAHD = @idBill AND @idProduct =MASP
	END
	ELSE
	BEGIN
		INSERT DBO.CHITIETHOADON(MAHD,MASP,SL)
		VALUES(@idBill,@idProduct,@count)
	END
END
GO
USE [master]
GO
ALTER DATABASE [QUANLYBANHANG] SET  READ_WRITE 
GO
